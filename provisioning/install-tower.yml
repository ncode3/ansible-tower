---
- vars:
    tower_tarball_location: http://10.55.3.153/ansible-tower-setup-latest.tar.gz

- include: firstboot.yml

- unarchive:
    src: "{{ tower_tarball_location }}"
    dest: /opt
    remote_src: True

- name: "Change the inventory passwords to 'ansible' for installation"
  shell: |
    cd ansible-tower-setup-*
    sed -i -e "s/admin_password=''/admin_password='ansible'/g" inventory
    sed -i -e "s/redis_password=''/redis_password='ansible'/g" inventory
    sed -i -e "s/pg_password=''/pg_password='ansible'/g" inventory
    sed -i -e "s/rabbitmq_password=''/rabbitmq_password='ansible'/g" inventory
  args:
    chdir: /opt

- name: "Install Ansible Tower"
  shell: |
    cd ansible-tower-setup-*
    ./setup.sh
  args:
    chdir: /opt
  become: true
