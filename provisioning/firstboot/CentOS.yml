---
- vars:
    packages: ['deltarpm','bash-completion','vim-enhanced','net-snmp','ntp','ntpdate','git','wget']
    enabled_svcs: ['sshd','network','rsyslog']
    disabled_svcs: ['NetworkManager']

- name: "Set up /etc/hosts file"
  shell: |
    hostname=$(hostname)
    shortname=$(hostname --short)
    newip=$(ip addr list eth0 | grep 'inet ' | cut -d ' ' -f 6 | cut -d / -f1)
    grep "${newip}" /etc/hosts || echo "${newip} ${hostname} ${shortname}" >> /etc/hosts
  become: true

- name: "Enabling and restarting services {{ enabled_svcs }}"
  service:
    name: "{{ item }}"
    state: restarted
    enabled: yes
  with_items: "{{ enabled_svcs }}"
  become: true

- name: "Stopping and disabling services {{ disabled_svcs }}"
  service:
    name: "{{ item }}"
    state: stopped
    enabled: no
  with_items: "{{ disabled_svcs }}"
  become: true
  when: (ansible_distribution == "CentOS" and ansible_distribution_major_version == "7")
  ignore_errors: yes

- name: "Installing rpms {{ packages }}"
  yum:
    name: "{{ item }}"
    state: latest
  with_items: "{{ packages }}"
  become: true

- name: "Custom configuration repo"
  file:
    path: /opt/git
    state: directory
    mode: 0755
    
- name: "Pull custom configuration from github"
  git:
    repo: 'https://github.com/syspimp/kubernetes-demo.git'
    dest: /opt/git

- name: "Updating MOTD"
  shell: cat custom/tiger.ascii > /etc/motd
  args:
    chdir: /opt/git/kubernetes-demo
  become: true

